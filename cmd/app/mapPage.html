<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
          crossorigin=""></script>
  <title>Go Gophers Maps</title>
  <style>
    .map-container {
      width: 48%;
      float: left; 
      border-style: solid;
      border-width: 3px;
      border-color: white;
    }
  </style>
</head>

<body>
  <p>Go Gophers Maps</p>
  <div class="map-container"> 
    <h1>Serialized Loading</h1>
    <div id="mapSerial" style="height:700px;"></div>
  </div> 

  <div class="map-container"> 
    <h1>Concurrent Loading</h1>
    <div id="mapConcurrent" style="height:700px"></div>
  </div> 
</body>

    <script type="text/javascript" charset="utf-8" async>
      var mapConcurrent = L.map("mapConcurrent").setView([39, -95], 4);

      L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
      }).addTo(mapConcurrent);
    </script>

    <script type="text/javascript" charset="utf-8" async>
      var mapSerial = L.map("mapSerial").setView([39, -95], 4);

      L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
      }).addTo(mapSerial);
    </script>

    <script>
      const wsConcurrent = new WebSocket("ws://localhost:8080/concurrent");
      wsConcurrent.onmessage = (event) => handleWebSocketMessage(event, mapConcurrent);
    </script>

    <script>
      const wsSerial = new WebSocket("ws://localhost:8080/serial");
      wsSerial.onmessage = (event) => handleWebSocketMessage(event, mapSerial);
    </script>

    <script>
      function handleWebSocketMessage(event, map) {
        try {
          const fireData = JSON.parse(event.data);

          fireData.forEach(fire => {
            const latitude = parseFloat(fire.Latitude);
            const longitude = parseFloat(fire.Longitude);

            if (isNaN(latitude) || isNaN(longitude)) {
              console.error("Invalid latitude or longitude:", fire);
              return;
            }

            L.marker([latitude, longitude])
              .addTo(map)
              .bindPopup(`${fire.Name}`);
          });
        } catch (error) {
          console.error("Error processing WebSocket message:", error);
        }
      }
    </script>
</html>